<!doctype html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<head>
<meta charset="utf-8">
<title>Ocean Observation System</title>
</head>
<link rel="stylesheet" type="text/css" href="oceanstyler.css">
<script src="imports.js"></script>
<script>permission = 'curator';</script>
 <body style="background:lightblue;">
 <div id='header' style="height:50px;border-style:inset;"></div>
  <div id='content'>
  
    <form action="uploadToDatabase.jsp" name="uploadform" method="post">
    <!-- taken from http://www.w3schools.com/tags/att_input_accept.asp 
         and http://www.freeformatter.com/mime-types-list.html 
      -->
      </br>
      Image Record:</br>
      <input type="file" id="jpgfileget" name="jpgfileget" accept="image/jpeg" onchange="openFile(this, event)">
      <div id="jpgload">Choose a JPG file please. Or leave empty to skip Image Record.</div> 
      <!--for now a text, later make a dropdown menu for numnber..-->
      <table>
      <tr><td>Sensor ID:</td><td><input type="number" id="jpgsensorid" name="jpgsensorid" placeholder="Sensor ID umber"></td></tr> 
      <tr><td>Date created:</td><td><input type="date" id="jpgdatecreated" name="jpgdatecreated" placeholder="yyyy-mm-dd"></td></tr> 
      <tr><td>Image description:</td><td><input type="text" id="jpgdescription" name="jpgdescription" maxlength="128" placeholder="Description goes here."></td></tr> 
      </table>
      </br>
      Audio Record:</br>
      <input type="file" id="audiofileget" name="audiofileget" accept="audio/x-wav" onchange="openFile(this, event)">
      <div id="wavload">Choose a WAV file please. Or leave empty to skip Audio Record.</div>
      <!--for now a text, later make a dropdown menu for numnber..-->
      <table>
      <tr><td>Sensor ID:</td><td><input type="number" id="wavsensorid" name="wavsensorid" placeholder="Sensor ID number"></td></tr> 
      <tr><td>Date created:</td><td><input type="date" id="wavdatecreated" name="wavdatecreated" placeholder="yyyy-mm-dd"></td></tr> 
      <tr><td>Audio length:</td><td><input type="number" id="wavlength" name="wavlength" min="0" placeholder="in seconds"></td></tr> 
      <tr><td>Audio description:</td><td><input type="text" id="wavdescription" name="wavdescription" maxlength="128" placeholder="Description goes here."></td></tr> 
      </table></br>
      Batch scalar data:</br>
      <input type="file" id="csvfileget" name="csvfileget" accept="text/csv" onchange="openFile(this, event)">
      <div id="csvload">Choose a csv file please. Or leave empty to skip Scalar Data.</div></br>
      </br>
      <input type="hidden" id="jpgfileput" name="jpgfileput">
      <input type="hidden" id="audiofileput" name="audiofileput">
      <input type="hidden" id="csvfileput" name="csvfileput">
      
      <!--Taken from http://www.javascripture.com/FileReader 
      and http://stackoverflow.com/questions/7627161/get-id-of-element-that-called-a-function
      should using loading ??  http://www.sitepoint.com/html5-javascript-file-upload-progress-bar/
      -->
      <script>
        var openFile = function(callingElement, event) {
          var input = event.target;
          var id = callingElement.id;

          var printEventType = function(e) {
            var loaded =  e.loaded;
            var total =  e.total;
            var percentage = (loaded/total)*100;
            var percentageString = "Uploading: " + percentage + "%";
            
            console.log('got event: ' + e.type +" loaded:" + loaded + " Total:"+ total);
            
            if(id === "jpgfileget") {
              $("#jpgload").html(percentageString);
            } else if(id === "audiofileget") {
              $("#wavload").html(percentageString);
            } else if(id === "csvfileget") {
              $("#csvload").html(percentageString);
            } 
          };

          var setHiddenField = function(e) {
            var base64File = reader.result;
            var stringReady = "File is ready to be submitted.";
            
            console.log('got base64:' + base64File);
            
            if(id === "jpgfileget") {
              $("#jpgfileput").val(base64File);
              $("#jpgload").html(stringReady);
            } else if(id === "audiofileget") {
              $("#audiofileput").val(base64File);
              $("#wavload").html(stringReady);
            } else if(id === "csvfileget") {
              $("#csvfileput").val(base64File);
              $("#csvload").html(stringReady);
            } 
          }
          
          var disableSubmit = function(e) {
            $("#submit").attr("disabled", true);
          }
          
          var enableSubmit = function(e) {
            $("#submit").attr("disabled", false);
          }
          
          var reader = new FileReader();
          reader.onloadstart = disableSubmit;
          reader.onprogress = printEventType;
          reader.onload = setHiddenField;
          //reader.onabort = printEventType;
          //reader.onerror = printEventType;
          reader.onloadend = enableSubmit;
          if(id === "csvfileget") {
            reader.readAsText(input.files[0]);
          } else {
            reader.readAsDataURL(input.files[0]);
          }
        };
      </script>    
      
      <input type="submit" id="submit" name="submit" value="Upload">
    </form>
  
  </div>

</body>
</html>
